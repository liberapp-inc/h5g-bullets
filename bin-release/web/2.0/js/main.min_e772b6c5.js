function rand(){return globalRandom.v()}function randF(e,t){return globalRandom.f(e,t)}function randI(e,t){return globalRandom.i(e,t)}function randBool(){return globalRandom.bool()}var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);a.prototype=t.prototype,e.prototype=new a},__awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(r,s){function n(e){try{l(i.next(e))}catch(t){s(t)}}function o(e){try{l(i["throw"](e))}catch(t){s(t)}}function l(e){e.done?r(e.value):new a(function(t){t(e.value)}).then(n,o)}l((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function a(e){return function(t){return i([e,t])}}function i(a){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,s&&(n=s[2&a[0]?"return":a[0]?"throw":"next"])&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[0,n.value]),a[0]){case 0:case 1:n=a;break;case 4:return l.label++,{value:a[1],done:!1};case 5:l.label++,s=a[1],a=[0];continue;case 7:a=l.ops.pop(),l.trys.pop();continue;default:if(n=l.trys,!(n=n.length>0&&n[n.length-1])&&(6===a[0]||2===a[0])){l=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){l.label=a[1];break}if(6===a[0]&&l.label<n[1]){l.label=n[1],n=a;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(a);break}n[2]&&l.ops.pop(),l.trys.pop();continue}a=t.call(e,l)}catch(i){a=[6,i],s=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var r,s,n,o,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},__assign=this&&this.__assign||Object.assign||function(e){for(var t,a=1,i=arguments.length;i>a;a++){t=arguments[a];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},GameObject=function(){function e(){this.display=null,e.objects.push(this)}return e.prototype.destroy=function(){this.deleteFlag=!0},e.prototype.onDestroy=function(){},Object.defineProperty(e.prototype,"px",{get:function(){return this.display.x},set:function(e){this.display.x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"py",{get:function(){return this.display.y},set:function(e){this.display.y=e},enumerable:!0,configurable:!0}),e.initial=function(t){e.display=t},e.process=function(){e.objects.forEach(function(e){return e.update()}),e.objects=e.objects.filter(function(e){return e.deleteFlag&&e._delete(),!e.deleteFlag}),e.transit&&(e.dispose(),e.transit(),e.transit=null)},e.dispose=function(){e.objects=e.objects.filter(function(e){return e.destroy(),e._delete(),!1})},e.prototype._delete=function(){this.onDestroy(),this.display&&(e.display.removeChild(this.display),this.display=null)},e.objects=[],e}();__reflect(GameObject.prototype,"GameObject");var SDK=!0,Main=function(e){function t(){var t=e.call(this)||this;return t.once(egret.Event.ADDED_TO_STAGE,t.addToStage,t),t}return __extends(t,e),t.prototype.addToStage=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return Util.init(this),GameObject.initial(this.stage),SDK?[4,Social.init()]:[3,2];case 1:e.sent(),e.label=2;case 2:return Game.loadSceneGamePlay(),egret.startTick(this.tickLoop,this),[2]}})})},t.prototype.tickLoop=function(e){return GameObject.process(),!1},t}(eui.UILayer);__reflect(Main.prototype,"Main");var EffectLine=function(e){function t(t,a,i,r,s){void 0===s&&(s=16760832);var n=e.call(this)||this;return n.frame=0,n.x=t,n.y=a,n.vx=i,n.vy=r,n.color=s,n.setShape(.01),n}return __extends(t,e),t.create=function(e,a,i,r,s){void 0===s&&(s=4);for(var n=0;s>n;n++){var o=rand()*Math.PI*2,l=Math.cos(o),p=-Math.sin(o),d=i*(2+n);new t(e+l*i,a+p*i,l*d,p*d,r)}},t.prototype.setShape=function(e){var t=new egret.Shape;this.display&&GameObject.display.removeChild(this.display),this.display=t,GameObject.display.addChild(this.display),e=e*Math.PI*.5;var a=Math.sin(e),i=1-Math.cos(e);t.graphics.lineStyle(6,this.color),t.graphics.moveTo(this.x+this.vx*a,this.y+this.vy*a),t.graphics.lineTo(this.x+this.vx*i,this.y+this.vy*i)},t.prototype.update=function(){if(++this.frame>=t.maxFrame)return void this.destroy();var e=this.frame/t.maxFrame;this.setShape(e)},t.maxFrame=30,t}(GameObject);__reflect(EffectLine.prototype,"EffectLine");var Bullet=function(e){function t(t,a,i,r,s){var n=e.call(this)||this,o=i*Deg2Rad;return r*=Util.w(BULLET_SPEED_PER_W),n.vx=-Math.sin(o)*r,n.vy=Math.cos(o)*r,n.radius=Util.w(BULLET_RADIUS_PER_W)*s,n.setDisplay(t,a,BULLET_COLOR),n}return __extends(t,e),t.prototype.setDisplay=function(e,t,a){this.display&&GameObject.display.removeChild(this.display);var i=new egret.Shape;this.display=i,GameObject.display.addChild(this.display),i.x=e,i.y=t,i.graphics.beginFill(a),i.graphics.drawCircle(0,0,this.radius),i.graphics.endFill()},t.prototype.update=function(){this.px+=this.vx,this.py+=this.vy;var e=Math.pow(Player.I.px-this.px,2)+Math.pow(Player.I.py-this.py,2);return e<Math.pow(Player.I.radius+this.radius,2)?(Player.I.hit(),void this.destroy()):void((Math.pow(this.px-Util.w(.5),2)>=Math.pow(Util.w(.5)+this.radius,2)||Math.pow(this.py-Util.h(.5),2)>=Math.pow(Util.h(.5)+this.radius,2))&&this.destroy())},t}(GameObject);__reflect(Bullet.prototype,"Bullet");var BType;!function(e){e[e.Ball=0]="Ball",e[e.Spear=1]="Spear",e[e.Laser=2]="Laser",e[e.None=100]="None",e[e.Loop=101]="Loop",e[e.Terminate=102]="Terminate"}(BType||(BType={}));var BAim;!function(e){e[e.Player=0]="Player",e[e.Direct=1]="Direct",e[e.Memory=2]="Memory",e[e.Random=3]="Random"}(BAim||(BAim={}));var BData=function(){function e(){this.aim=BAim.Player,this.degree360=0,this.way=0,this.range360=0,this.speed=1,this.size=1}return e}();__reflect(BData.prototype,"BData");var Enemy=function(e){function t(a,i,r){var s=e.call(this)||this;return s.listIndex=0,s.index=0,s.frame=0,s.degree360=0,s.loopIndex=0,s.loopCount=0,s.speed=1,t.total++,s.dataList=r,s.data=r[0],s.speed=1+3*Wave.hardRate,s.frame=s.speed,s.setDisplay(a,i,ENEMY_COLOR),s}return __extends(t,e),t.prototype.onDestroy=function(){t.total--},t.prototype.setDisplay=function(e,t,a){this.display&&GameObject.display.removeChild(this.display);var i=new egret.Shape;this.display=i,GameObject.display.addChild(this.display),i.x=e,i.y=t;var r=Util.w(ENEMY_SIZE_PER_W),s=r;i.graphics.beginFill(a),i.graphics.drawRect(.5*-r,.5*-s,r,s),i.graphics.endFill(),i.rotation=45},t.prototype.update=function(){this.processData()},t.prototype.processData=function(){for(this.frame-=this.speed;this.frame<=0;){var e=this.data[this.index];switch(e.type){case BType.Terminate:return void this.terminate();case BType.Loop:this.loopIndex!=this.index&&(this.loopIndex=this.index,this.loopCount=e.size),--this.loopCount>0?this.index=0:(this.loopIndex=0,this.index++);break;case BType.None:this.degree360=this.getDegree(e),this.frame+=e.frame,this.index++;break;case BType.Ball:var t=this.getDegree(e);if(e.way<=1)new Bullet(this.px,this.py,t,e.speed*this.speed,e.size);else{var a=e.way,i=e.range360,r=i/(a-1);for(t-=i/2;a>0;)new Bullet(this.px,this.py,t,e.speed*this.speed,e.size),t+=r,a--}this.frame+=e.frame,this.index++}if(this.index>=this.data.length){if(this.listIndex++,!(this.listIndex<this.dataList.length))return void this.terminate();this.data=this.dataList[this.listIndex],this.index=0}}},t.prototype.getDegree=function(e){var t=0;switch(e.aim){case BAim.Player:var a=Player.I.px-this.px,i=Player.I.py-this.py;t=Math.atan2(-a,i)*Rad2Deg,t+=e.degree360;break;case BAim.Direct:t=e.degree360;break;case BAim.Memory:t=this.degree360+e.degree360;break;case BAim.Random:t=this.degree360+randF(-.5*e.range360,.5*e.range360)}return t},t.prototype.terminate=function(){this.destroy(),new EffectCircle(this.px,this.py,2*this.display.getBounds().width,EFFECT_COLOR),this.data=null,this.dataList=null},t.total=0,t.data0=[{type:BType.Ball,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:60},{type:BType.Ball,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:60},{type:BType.None,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:1,range360:0,speed:1,size:1,frame:20},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:2,range360:15,speed:1,size:1,frame:20},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:3,range360:30,speed:1,size:1,frame:20},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:4,range360:45,speed:1,size:1,frame:20},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:5,range360:60,speed:1,size:1,frame:60},{type:BType.Loop,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:2,frame:0},{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList0=[t.data0],t.data1=[{type:BType.Ball,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1.4,size:1,frame:8},{type:BType.Loop,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:20,frame:0},{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList1=[t.data1],t.data2=[{type:BType.Ball,aim:BAim.Player,degree360:0,way:2,range360:20,speed:1,size:1,frame:60},{type:BType.Loop,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:8,frame:0},{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList2=[t.data2],t.data3=[{type:BType.Ball,aim:BAim.Player,degree360:0,way:3,range360:40,speed:1,size:1,frame:75},{type:BType.Loop,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:4,frame:0},{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList3=[t.data3],t.data4=[{type:BType.Ball,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1.4,size:1.5,frame:90},{type:BType.Loop,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:4,frame:0},{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList4=[t.data4],t.data50=[{type:BType.None,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:60}],t.data51=[{type:BType.Ball,aim:BAim.Memory,degree360:0,way:2,range360:240,speed:1,size:1,frame:2},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:2,range360:210,speed:1,size:1,frame:2},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:2,range360:180,speed:1,size:1,frame:2},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:2,range360:150,speed:1,size:1,frame:2},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:2,range360:120,speed:1,size:1,frame:2},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:2,range360:90,speed:1,size:1,frame:2},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:2,range360:60,speed:1,size:1,frame:2},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:2,range360:30,speed:1,size:1,frame:2},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:1,range360:0,speed:1,size:1.5,frame:74}],t.data52=[{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList5=[t.data50,t.data51,t.data50,t.data51,t.data50,t.data51,t.data52],t.data6=[{type:BType.Ball,aim:BAim.Direct,degree360:0,way:0,range360:0,speed:1.2,size:1,frame:20},{type:BType.Loop,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:6,frame:0},{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList6=[t.data6],t.data7=[{type:BType.Ball,aim:BAim.Direct,degree360:0,way:2,range360:20,speed:1.2,size:1,frame:20},{type:BType.Loop,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:4,frame:0},{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList7=[t.data7],t.data80=[{type:BType.None,aim:BAim.Direct,degree360:0,way:0,range360:0,speed:1,size:1,frame:60}],t.data81=[{type:BType.Ball,aim:BAim.Memory,degree360:45,way:4,range360:270,speed:1,size:1,frame:12},{type:BType.None,aim:BAim.Memory,degree360:0,way:0,range360:0,speed:1,size:1,frame:0},{type:BType.Loop,aim:0,degree360:0,way:0,range360:0,speed:1,size:18,frame:1}],t.data82=[{type:BType.Ball,aim:BAim.Memory,degree360:45,way:4,range360:270,speed:1,size:1,frame:12},{type:BType.None,aim:BAim.Memory,degree360:5,way:0,range360:0,speed:1,size:1,frame:0},{type:BType.Loop,aim:0,degree360:0,way:0,range360:0,speed:1,size:18,frame:1}],t.data83=[{type:BType.Ball,aim:BAim.Memory,degree360:45,way:4,range360:270,speed:1,size:1,frame:12},{type:BType.None,aim:BAim.Memory,degree360:-5,way:0,range360:0,speed:1,size:1,frame:0},{type:BType.Loop,aim:0,degree360:0,way:0,range360:0,speed:1,size:18,frame:1}],t.data84=[{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList8=[t.data80,t.data81,t.data82,t.data83,t.data84],t.data9=[{type:BType.Ball,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:8},{type:BType.Loop,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:100,frame:0},{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList9=[t.data9],t.data10=[{type:BType.None,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:60},{type:BType.None,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:3,range360:60,speed:.8,size:1,frame:0},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:2,range360:30,speed:.7,size:1.5,frame:16},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:3,range360:60,speed:1.1,size:1,frame:0},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:2,range360:30,speed:1,size:1.5,frame:44},{type:BType.Loop,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:2,frame:0},{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList10=[t.data10],t.data11_0=[{type:BType.None,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:60}],t.data11_1=[{type:BType.None,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:5,range360:120,speed:.7,size:1,frame:4},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:5,range360:120,speed:.8,size:1,frame:4},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:5,range360:120,speed:.9,size:1,frame:4},{type:BType.Ball,aim:BAim.Memory,degree360:0,way:5,range360:120,speed:1,size:1,frame:124},{type:BType.Loop,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:2,frame:0},{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList11=[t.data11_0,t.data11_1],t.data12=[{type:BType.Ball,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1.5,size:1.25,frame:0},{type:BType.Ball,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1.4,size:1.25,frame:0},{type:BType.Ball,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1.3,size:1.25,frame:10},{type:BType.Terminate,aim:BAim.Player,degree360:0,way:0,range360:0,speed:1,size:1,frame:0}],t.dataList12=[t.data12],t}(GameObject);__reflect(Enemy.prototype,"Enemy");var PLAYER_RADIUS_PER_W=1/64,BULLET_RADIUS_PER_W=1/56,BULLET_SPEED_PER_W=1/160,ENEMY_SIZE_PER_W=.05,SAVE_KEY_BESTSCORE="bullets-bestScore",BACK_COLOR=41215,FONT_COLOR=65535,PLAYER_COLOR=15791352,BULLET_COLOR=15791352,ENEMY_COLOR=8451320,EFFECT_COLOR=FONT_COLOR,Game=function(){function e(){}return e.loadSceneGamePlay=function(){new Background,new Score,new Player(.5*Util.width,.8*Util.height),new Wave,new StartMessage},e}();__reflect(Game.prototype,"Game");var Player=function(e){function t(a,i){var r=e.call(this)||this;return r.buttonOffsetX=0,r.buttonOffsetY=0,r.state=r.stateNone,r.step=0,r.scale=1,t.I=r,r.radius=PLAYER_RADIUS_PER_W*Util.width,r.scrollSpeed=Util.height/120,r.setDisplay(a,i),r.button=new Button(null,0,0,.5,.5,1,1,0,0,null),r}return __extends(t,e),t.prototype.onDestroy=function(){this.button.destroy(),t.I=null},t.prototype.setDisplay=function(e,t){this.display&&GameObject.display.removeChild(this.display);var a=new egret.Shape;this.display=a,GameObject.display.addChild(this.display),a.x=e,a.y=t;var i=.75*this.radius;a.graphics.lineStyle(2,PLAYER_COLOR),a.graphics.moveTo(0*i,-6.5*i),a.graphics.lineTo(-5*i,3.5*i),a.graphics.lineTo(5*i,3.5*i),a.graphics.lineTo(0*i,-6.5*i),a.graphics.beginFill(PLAYER_COLOR),a.graphics.drawCircle(0,0,1.25*this.radius),a.graphics.endFill()},t.prototype.update=function(){this.state()},t.prototype.setStateNone=function(){this.state=this.stateNone},t.prototype.stateNone=function(){},t.prototype.setStateMove=function(){this.state=this.stateMove,this.step=0},t.prototype.stateMove=function(){if(this.button.press)this.buttonOffsetX=this.px-this.button.x,this.buttonOffsetY=this.py-this.button.y;else{var e=1.25,t=this.button.x+this.buttonOffsetX-this.px,a=this.button.y+this.buttonOffsetY-this.py;this.px=Util.clamp(this.px+t*e,this.radius,Util.width-this.radius),this.py=Util.clamp(this.py+a*e,this.radius,Util.h(.9)-this.radius),this.buttonOffsetX=this.px-this.button.x,this.buttonOffsetY=this.py-this.button.y}},t.prototype.stateGameOver=function(){},t.prototype.hit=function(){this.state==this.stateMove&&(new GameOver,new EffectCircle(this.px,this.py,3*this.radius,PLAYER_COLOR),EffectLine.create(this.px,this.py,3*this.radius,PLAYER_COLOR),this.state=this.stateGameOver)},t.I=null,t}(GameObject);__reflect(Player.prototype,"Player");var Wave=function(e){function t(){var a=e.call(this)||this;return a.index=0,a.frame=0,a.count=0,a.type=-1,t.hardRate=0,a}return __extends(t,e),t.prototype.update=function(){if(Player.I.state!=Player.I.stateNone&&(this.frame-=1+3*t.hardRate,!(this.frame>=0))){this.count++,t.hardRate=Util.clamp(Score.I.point/90,0,1);var e=13,a=randI(0,e);switch(a==this.type&&(a=(a+1)%e),this.type=a,this.type){case 0:new Enemy(Util.w(randF(.2,.8)),Util.h(.1),Enemy.dataList0),this.frame=520;break;case 1:new Enemy(Util.w(.5),Util.h(.2),Enemy.dataList1),this.frame=160;break;case 2:new Enemy(Util.w(.25),Util.h(.1),Enemy.dataList2),new Enemy(Util.w(.75),Util.h(.1),Enemy.dataList2),this.frame=480;break;case 3:new Enemy(Util.w(.3),Util.h(.15),Enemy.dataList3),new Enemy(Util.w(.7),Util.h(.15),Enemy.dataList3),this.frame=300;break;case 4:new Enemy(Util.w(randF(.1,.9)),Util.h(randF(.05,.2)),Enemy.dataList4),this.frame=360;break;case 5:new Enemy(Util.w(randF(.4,.6)),Util.h(.2),Enemy.dataList5),this.frame=330;break;case 6:new Enemy(Util.w(.3),Util.h(.2),Enemy.dataList6),new Enemy(Util.w(.7),Util.h(.2),Enemy.dataList6),this.frame=120;break;case 7:new Enemy(Util.w(.25),Util.h(.1),Enemy.dataList7),new Enemy(Util.w(.75),Util.h(.1),Enemy.dataList7),this.frame=80;break;case 8:new Enemy(Util.w(.5),Util.h(.2),Enemy.dataList8),this.frame=924;break;case 9:new Enemy(Util.w(randF(.2,.8)),Util.h(randF(.1,.25)),Enemy.dataList9),this.frame=800;break;case 10:new Enemy(Util.w(randF(.2,.8)),Util.h(randF(.05,.25)),Enemy.dataList10),this.frame=240;break;case 11:new Enemy(Util.w(randF(.1,.9)),Util.h(randF(.05,.2)),Enemy.dataList11),new Enemy(Util.w(randF(.1,.9)),Util.h(randF(.05,.2)),Enemy.dataList11),this.frame=340;break;case 12:new Enemy(Util.w(randBool()?.3:.7),Util.h(.05),Enemy.dataList12),this.frame=10}0==(1&this.count)?this.frame+=240:this.frame*=1-.25*Math.pow(t.hardRate,2)}},t.hardRate=0,t}(GameObject);__reflect(Wave.prototype,"Wave");var Button=function(e){function t(t,a,i,r,s,n,o,l,p,d){var h=e.call(this)||this;h.text=null,h.onTap=null,h.press=!1,h.touch=!1,h.x=0,h.y=0;var y=new egret.Shape;GameObject.display.addChild(y),y.graphics.beginFill(l,p);var c=n*Util.width,m=o*Util.height;return y.graphics.drawRoundRect(-.5*c,-.5*m,c,m,.2*c),y.graphics.endFill(),y.touchEnabled=!0,y.x=r*Util.width,y.y=s*Util.height,h.display=y,t&&(h.text=Util.newTextField(t,a,i,r,s,!0,!1),GameObject.display.addChild(h.text)),h.onTap=d,h.onTap&&h.display.addEventListener(egret.TouchEvent.TOUCH_TAP,h.onTap,h),h.display.addEventListener(egret.TouchEvent.TOUCH_BEGIN,h.touchBegin,h),h.display.addEventListener(egret.TouchEvent.TOUCH_MOVE,h.touchMove,h),h.display.addEventListener(egret.TouchEvent.TOUCH_END,h.touchEnd,h),h}return __extends(t,e),t.prototype.onDestroy=function(){this.onTap&&this.display.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),GameObject.display.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),GameObject.display.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameObject.display.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.text&&GameObject.display.removeChild(this.text)},t.prototype.update=function(){var e=this.touch?1.1:1;this.display.scaleX=this.display.scaleY=this.display.scaleX+.25*(e-this.display.scaleX),this.press=!1},t.prototype.touchBegin=function(e){this.x=e.stageX,this.y=e.stageY,this.press=!0,this.touch=!0},t.prototype.touchMove=function(e){this.x=e.stageX,this.y=e.stageY,this.touch=!0},t.prototype.touchEnd=function(e){this.touch=!1},t}(GameObject);__reflect(Button.prototype,"Button");var EffectCircle=function(e){function t(a,i,r,s){void 0===s&&(s=16760832);var n=e.call(this)||this;return n.frame=t.maxFrame,n.radius=r,n.color=s,n.setShape(a,i,n.radius),n}return __extends(t,e),t.prototype.setShape=function(e,a,i){var r=new egret.Shape;this.display&&GameObject.display.removeChild(this.display),this.display=r,GameObject.display.addChild(this.display),r.x=e,r.y=a,r.graphics.lineStyle(3+10*(this.frame/t.maxFrame),this.color),r.graphics.drawCircle(0,0,i)},t.prototype.update=function(){return--this.frame<=0?void this.destroy():(this.radius*=1.03,void this.setShape(this.display.x,this.display.y,this.radius))},t.maxFrame=30,t}(GameObject);__reflect(EffectCircle.prototype,"EffectCircle");var Random=function(){function e(t){void 0===t&&(t=Math.floor(Math.random()*e.max)),this.x=123456789,this.y=362436069,this.z=521288629,this.w=t}return e.prototype.v=function(){return(this.next()&e.max)/(e.max+1)},e.prototype.f=function(e,t){return e+this.v()*(t-e)},e.prototype.i=function(e,t){return Math.floor(this.f(e,t))},e.prototype.bool=function(){return 0!=(1&this.next())},e.prototype.next=function(){var e;return e=this.x^this.x<<11,this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^(e^e>>>8)},e.max=268435455,e}();__reflect(Random.prototype,"Random");var globalRandom=new Random,Sdk=function(){function e(){}return e.loadSdk=function(){return __awaiter(this,void 0,void 0,function(){var e,t,a;return __generator(this,function(i){switch(i.label){case 0:return console.log("============================================================"),console.log("Liberapp.loadSdk:"),this.env=this.detectMode(location.origin),console.log("env: ",this.env),e=this.resolveSdkUrl(this.sdkPath),console.log("srcUrl: ",e),[4,this.loadScript(e)];case 1:return t=i.sent(),console.log("script:",t),a=window.LiberappSdk,"egret-wing"!==this.env?[3,3]:[4,a.enableDebug()];case 2:i.sent(),i.label=3;case 3:return console.log("liberappSdk:",a),[2,a]}})})},e.detectMode=function(e){return/^https:\/\/(.+)\.a\.liberapp\.net$/.test(e)?"production":/^https:\/\/(.+)\.a\.staging.\.liberapp\.net$/.test(e)?"staging":/^https:\/\/(.+)\.a\.development\.liberapp\.net$/.test(e)?"development":"egret-wing"},e.resolveSdkUrl=function(e){var t=this.baseUrls[this.env];return""+t+e},e.loadScript=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,a){var i=document.createElement("script");i.async=!1,i.src=e,i.onload=function(){return t(i)},i.onerror=function(){return a(new Error("Can not load script: src:"+e))},document.head.append(i)})]})})},e.baseUrls={production:"https://liberapp.net",staging:"https://staging.liberapp.net",development:"https://localhost","egret-wing":"https://staging.liberapp.net"},e.sdkPath="/dist/sdk/liberapp-ja-0_9.js",e}();__reflect(Sdk.prototype,"Sdk");var Social=function(){function e(){}return e.init=function(){return __awaiter(this,void 0,void 0,function(){var e,t,a,i,r,s,n,o,l,p;return __generator(this,function(d){switch(d.label){case 0:return[4,Sdk.loadSdk()];case 1:return e=d.sent(),this.sdk=e,Toast.show({text:"ログイン中・・・",delay:3e4,canHide:!0}),[4,e.initializeAsync()];case 2:return d.sent(),[4,e.startGameAsync()];case 3:return d.sent(),Toast.show({text:this.playerName+"さんようこそ！",delay:3e4,canHide:!0}),t=this,[4,e.getLeaderboardAsync("default")];case 4:return t.leaderboard=d.sent(),[4,Promise.all([this.leaderboard.getEntryCountAsync(),this.leaderboard.getEntriesAsync(3,0),this.leaderboard.getPlayerEntryAsync(),this.sdk.player.getDataAsync(["level"])])];case 5:return a=d.sent(),i=a[0],r=a[1],s=a[2],n=a[3],this.playerEntry=s,this.rawData=n,this.hasBest?Toast.show({text:"今のところ"+i+"人中"+this.bestRank+"位です",delay:3e3}):(o=r[0],o&&(console.log(o),l=o.getPlayer().getName(),p=o.getScore(),Toast.show({text:i+"人が遊んでいます!\n一番は"+l+"さん\nスコアは"+p+"です",delay:3e3}))),[2]}})})},Object.defineProperty(e,"hasBest",{get:function(){return!!this.myBestEntry},enumerable:!0,configurable:!0}),Object.defineProperty(e,"bestScore",{get:function(){return this.hasBest?this.myBestEntry.getScore():0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"bestRank",{get:function(){return this.hasBest?this.myBestEntry.getRank():void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"playerEntry",{set:function(t){console.log("myBest:",this.myBestEntry,t),this.myBestEntry=t,Score.bestScore=e.bestScore,Score.bestRank=e.bestRank},enumerable:!0,configurable:!0}),e.setScore=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(a){switch(a.label){case 0:return console.log("setScore "+e),Toast.show({text:"ハイスコアを送信中",delay:3e4,canHide:!0}),t=this,[4,this.leaderboard.setScoreAsync(e)];case 1:return t.playerEntry=a.sent(),Toast.show({text:"順位は"+this.bestRank+"位でした",delay:3e3}),[2]}})})},Object.defineProperty(e,"playerName",{get:function(){return this.sdk.player.getName()||"名無し"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"hasData",{get:function(){return!!this.rawData},enumerable:!0,configurable:!0}),Object.defineProperty(e,"level",{get:function(){return this.hasData&&"level"in this.rawData?this.rawData.level:0},enumerable:!0,configurable:!0}),e.setLevel=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.rawData.level=e,console.log("setLevel "+e+" "+this.rawData.level),Toast.show({text:"達成レベルを送信中",delay:3e4,canHide:!0}),[4,this.sdk.player.setDataAsync({level:e})];case 1:return t.sent(),Toast.show({text:"送信完了",delay:1500}),[2]}})})},e}();__reflect(Social.prototype,"Social");var DefaultToastOptions={text:"",delay:3e3,canHide:!1},Toast=function(e){function t(t){var a=e.call(this)||this;return a.queue=[],a.rect=new eui.Rect,a.rect.alpha=0,a.label=new eui.Label,a.label.maxWidth=t,a.rect.addEventListener(eui.UIEvent.CREATION_COMPLETE,a.onRectCreationComplete,a),a.label.addEventListener(eui.UIEvent.RESIZE,a.onLabelResized,a),GameObject.display.addChild(a.rect),a}return __extends(t,e),t.prototype.update=function(){},t.show=function(e){var a=__assign({},DefaultToastOptions,e);this.I||(this.I=new t(.6*Util.width)),this.I.show(a)},t.prototype.onDestroy=function(){var e=t.I;t.I=void 0,e&&(e.rect.parent.removeChild(e.rect),e.rect.removeChildren(),e.rect=void 0,e.label=void 0)},t.prototype.show=function(e){if(console.log("Toast.show"),this.currentOptions){if(!this.currentOptions.canHide)return void this.queue.push(e);this.currentTween.setPaused(!0),this.currentTween=void 0,this.currentOptions=void 0,this.queue=[]}this.currentOptions=e,this.toastText=e.text,this.currentTween=egret.Tween.get(this.rect),this.currentTween.to({alpha:1},300).wait(e.delay).call(this.onStartHide,this)},t.prototype.onStartHide=function(){console.log("Toast.onStartHide"),void 0!==this.currentTween&&(this.currentTween=egret.Tween.get(this.rect),this.currentTween.to({alpha:0},300).call(this.onCompleteHide,this))},t.prototype.onCompleteHide=function(){if(console.log("Toast.onCompleteHide"),this.currentTween=void 0,this.currentOptions=void 0,0===this.queue.length)return void this.destroy();var e=this.queue.shift();this.show(e)},t.prototype.onRectCreationComplete=function(){console.log("Toast.onRectCreationComplete"),this.rect.fillColor=0,this.rect.fillAlpha=.6,this.rect.horizontalCenter=0,this.rect.verticalCenter=0,this.rect.ellipseWidth=30,this.rect.ellipseHeight=30,this.label.x=20,this.label.y=20,this.label.size=28,this.rect.addChild(this.label),this.toastText=""},Object.defineProperty(t.prototype,"toastText",{set:function(e){console.log("Toast.toastText:"),this.label.text=e},enumerable:!0,configurable:!0}),t.prototype.onLabelResized=function(){console.log("Toast.onLabelResized:"),this.rect.width=this.label.width+40,this.rect.height=this.label.height+40,this.rect.x=(Util.width-this.rect.width)/2,this.rect.y=(Util.height-this.rect.height)/2},t}(GameObject);__reflect(Toast.prototype,"Toast");var Deg2Rad=Math.PI/180,Rad2Deg=180/Math.PI,Util=function(){function e(){}return e.w=function(t){return t*e.width},e.h=function(t){return t*e.height},e.init=function(e){this.width=e.stage.stageWidth,this.height=e.stage.stageHeight},e.clamp=function(e,t,a){return t>e&&(e=t),e>a&&(e=a),e},e.lerp=function(e,t,a){return e+(t-e)*a},e.color=function(e,t,a){return 65536*Math.floor(255*e)+256*Math.floor(255*t)+Math.floor(255*a)},e.colorLerp=function(e,t,a){var i=1-a,r=((16711680&e)*i+(16711680&t)*a&16711680)+((65280&e)*i+(65280&t)*a&65280)+((255&e)*i+(255&t)*a&255);return r},e.newTextField=function(t,a,i,r,s,n,o){var l=new egret.TextField;return l.text=t,l.bold=n,l.size=a,l.textColor=i,o?(l.x=(e.width-l.width)*r,l.y=(e.height-l.height)*s):(l.x=e.width*r-.5*l.width,l.y=e.height*s-.5*l.height),l},e}();__reflect(Util.prototype,"Util");var Background=function(e){function t(){var t=e.call(this)||this,a=new egret.Shape;return t.display=a,a.graphics.lineStyle(2,PLAYER_COLOR),a.graphics.drawRect(0,0,Util.width,Util.h(.9)),GameObject.display.addChild(a),t}return __extends(t,e),t.prototype.update=function(){},t}(GameObject);__reflect(Background.prototype,"Background");var GameOver=function(e){function t(){var t=e.call(this)||this;return t.texts=[],t.retryButton=null,t.step=0,t.fadeInFrame=60,t.texts[0]=Util.newTextField("SCORE : "+Score.I.point.toFixed(1),Util.width/12,FONT_COLOR,.5,.3,!0,!1),t.texts[0].alpha=0,SDK&&Score.bestScore<Score.I.point&&(Score.bestScore=Score.I.point,Social.setScore(Score.I.point),t.texts[0]=Util.newTextField("NEW RECORD!",Util.width/13,FONT_COLOR,.5,.4,!0,!1),egret.Tween.get(t.texts[0],{loop:!0}).to({alpha:0},500).to({alpha:1},500)),t.texts.forEach(function(e){GameObject.display.addChild(e)}),t}return __extends(t,e),t.prototype.onDestroy=function(){this.texts.forEach(function(e){GameObject.display.removeChild(e)})},t.prototype.update=function(){if(this.step<this.fadeInFrame){this.step++;var e=this.step/this.fadeInFrame;this.texts[0].alpha=e,this.step==this.fadeInFrame&&(this.retryButton=new Button("リトライ",Util.width/16,BACK_COLOR,.5,.7,.4,.1,FONT_COLOR,1,this.onTapRetry))}},t.prototype.onTapRetry=function(){GameObject.transit=Game.loadSceneGamePlay,this.destroy()},t}(GameObject);__reflect(GameOver.prototype,"GameOver");var Score=function(e){function t(){var a=e.call(this)||this;return a.point=0,a.text=null,a.textBest=null,t.I=a,a.point=0,a.text=Util.newTextField("0",Util.width/22,FONT_COLOR,.5,0,!0,!0),GameObject.display.addChild(a.text),a.textBest=Util.newTextField("BEST:"+t.bestScore,Util.width/22,FONT_COLOR,0,0,!0,!0),GameObject.display.addChild(a.textBest),a}return __extends(t,e),t.prototype.onDestroy=function(){GameObject.display.removeChild(this.text),this.text=null,GameObject.display.removeChild(this.textBest),this.textBest=null,t.I=null},t.prototype.update=function(){Player.I.state==Player.I.stateMove&&(this.point+=1/60,this.text.text=""+this.point.toFixed(1),t.bestScore<this.point&&(this.textBest.text="BEST:"+this.point.toFixed(1)))},t.I=null,t.bestScore=0,t.bestRank=0,t
}(GameObject);__reflect(Score.prototype,"Score");var StartMessage=function(e){function t(){var t=e.call(this)||this;return t.texts=[],t.texts[0]=Util.newTextField("弾幕よけろ！",Util.width/10,FONT_COLOR,.5,.3,!1,!1),t.texts.forEach(function(e){GameObject.display.addChild(e)}),GameObject.display.once(egret.TouchEvent.TOUCH_BEGIN,t.tap,t),t}return __extends(t,e),t.prototype.onDestroy=function(){this.texts.forEach(function(e){GameObject.display.removeChild(e)}),this.texts=null},t.prototype.update=function(){},t.prototype.tap=function(e){Player.I.setStateMove(),this.destroy()},t}(GameObject);__reflect(StartMessage.prototype,"StartMessage");